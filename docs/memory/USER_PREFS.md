# USER_PREFS（外置记忆）

只记录用户已明确提出、跨回合持续生效的要求与偏好。

## 沟通与语言

- 默认使用中文对话；若用户无特殊要求，所有说明与回复用中文。
- 编辑文件时使用该文件的原始语言。
- 将用户的所有问题都理解为疑问并明确回答（不要当反问处理）。

## 工具与资料

- 搜索文件与文本优先使用 `rg` / `fd`。
- 脚本化优先用 bash，避免不必要的 Python。
- 如需外部技术文档，优先使用 context7mcp（而不是网络搜索）。
- 如需 sudo，必须加 `-n`；若无权限需反馈用户。

## 工作方式与约束

- 在用户未明确要求开始行动前，将对话视为交流，不要擅自进行工作。
- 做“验证/验收/回归”时，Linux 侧与 Windows 侧都要一起验证：不能只测一边就算完成（尤其是涉及 Tauri/Rust/热键/窗口等 Windows-only 行为时）。
- 对于所有 bug 修复与功能更新：必须先在 Windows 侧同步到最新源码，然后重新编译，并以 Debug 模式拉起后再做验证（不能只停留在 Linux 侧）。
- Windows Debug 拉起时只保留“一个最新且有效”的开发会话，避免多套 `tauri dev`/`vite`/`typevoice-desktop` 并存造成端口占用和诊断混淆。
- 除非用户明确要求 workaround/fallback/备选/降级方案，否则严禁自行采用或规划此类方案。
- 严格禁止以“最小成本/快速验证/先把现象改正确”为理由，擅自采用任何扭曲目标或偏离用户要求的做法（包括但不限于：临时改写成另一套提示词、用禁词列表卡行为、绕开用户指定的修改点去做旁路实验）。若确实需要此类手段，必须先得到用户明确许可。
- 脚本与工具必须保持“路径无关/平台无关”：不得把个人绝对路径（例如某个用户的 WSL 路径或某台机器的盘符路径）写死在脚本里；执行时由运行者自行切换到合适目录并设置环境变量。
- 严禁假设所有开发者都在 WSL 环境工作（本项目可在 WSL2 + Windows 或纯 Windows 环境中开发/编译/运行）。
- 当用户在做提示词相关工作（prompt 调整/测试/对比）时：
  - 不得擅自重写/替换用户原有提示词的主体结构与细则；只允许按用户明确要求去修改对应段落或措辞。
  - 用户要求查看“完整输入/输出”时，必须在回复中直接粘贴完整内容，不得只给文件路径或让用户自行打开文件。
- 对“可诊断性”要求：不要引入需要手工维护的 `file:line` 标记体系（代码一改就失效）；定位应依赖稳定 step_id/错误码 + 运行时 backtrace/错误链。
- 在 Git 仓库中完成任务时，要求原子化 commit。
- “记录坑（PITFALLS）”仅记录实际执行过程中真实遇到、且超出预期的问题；禁止在计划阶段预先把可能风险写入 PITFALLS.md。
- 若 `git commit` 因 1Password 弹出签名/解锁输入框但无人输入而失败：不要用“跳过签名提交”（例如 `--no-gpg-sign`）；保留工作区变更，等待用户回来后再正常签名提交。
- 在非 Git 仓库目录中，不得未经允许创建 Git 仓库。
- 当用户要求“修复环境变量/就地修复”时：必须仅在用户原本已验证可用的那套环境中操作，禁止擅自切换到新的工作副本或引入额外安装步骤（依赖/模型/工具链下载）；若确需切换或安装，必须先得到用户明确许可。
- 当用户明确要求“严格按文档命令执行”时：不得改写命令本体、不得额外包裹脚本或添加前后置步骤；若命令失败，应先定位并修复环境根因，再继续执行同一条文档命令。

## 产品形态偏好

- 不在 UI 上增加“发送预览/勾选上下文”等交互；上下文采集与发送应自动完成。
- 长期目标流程以“快捷键按下即录音、松开即转录并发送、最终得到文本”为主；因此不依赖用户在 UI 上做复杂操作。

## 外置记忆文件存放

- 外置记忆文件放在 `docs/memory/`（用户已指定）。

- 维护 `AGENTS.md` 项目索引时，必须使用项目完整排除目录集（与当前 block 的 `exclude_dirs` 一致）；禁止回退为脚本默认排除集。
- 在汇报“可用/不可用/已修复”时，必须按单一 `task_id` 给证据链，不能把不同任务的日志混在一起下结论。
